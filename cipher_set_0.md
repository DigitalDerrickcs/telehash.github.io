Cipher Set 0
============

Minimum lightweight profile to support embedded devices.

The base algorithms used in this set are:

* `hashing` - SHA1, HMAC-SHA1
* `hashname key` - ECC 128r1
* `line key` - ECC 128r1
* `line cipher` - AES-128-CTR

## Hashname Key

When generating a hashname including CS-0, the public/private keypair is an ECC 128r1 curve and the binary public key format is [uncompressed][] with the first identifier byte (0x04) truncated, resulting in 32 bytes (X and Y of the curve).  In this document this is referred to as the hashname-key.

The fingerprint is generated by using SHA1 on the binary public key, resulting in a 40 character hex string.

## Open

In order to create a line, a switch must generate a new temporary ECC key, caled the line-key. The line-key is used along with ECDH and AES-128-CTR to encrypt the open and line packets.

The BODY of any open packet is binary and defined with the following byte sections in sequential order:

* `0-19` - the HMAC
* `20-51` - the sender's public line-key
* `52-68` - the IV
* `69+` - the AES-128-CTR encrypted inner packet

By performing ECDH with the sender's given line-key and the recipient's hashname-key, the resulting secret and IV are used to create the AES cipher and decode the inner packet.

The inner packet then contains the sender's public key and hashname keys and must be verified.  Using the public key attached to the inner packet and ECDH with the recipients public key, the shared secret is used as the input to the HMAC and verified against the original BODY after the HMAC (bytes 20+).

## Line

Line secrets are generated by using ECDH with both line-keys, and performing a SHA1 with the secret and line ids from the inner packet:

* line encryption key: SHA1(secret, my-line-id, their-line-id)
* line decryption key: SHA1(secret, their-line-id, my-line-id)

The JSON only contains a `"line":"line-id"`, the BODY is binary and defined as:

* `0-19` - the HMAC
* `20-35` - the IV
* `36+` - the AES-128-CTR encrypted channel packet

Using the correct line key the HMAC can be verified/created, and then using key with the IV the channel packet can be encrypted/decrypted.




[uncompressed]: https://www.secg.org/collateral/sec1_final.pdf
[sha-256]: https://en.wikipedia.org/wiki/SHA-2
