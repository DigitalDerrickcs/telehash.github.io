Cipher Set 1a
============

Minimum lightweight profile to support embedded devices or low resource environments.

The base algorithms used in this set are:

* SHA1
* ECC secp160r1
* HMAC-SHA1
* AES-128-CTR

## Hashname Fingerprint

When generating a hashname including CS1a, the public/private keypair is an ECC secp160r1 curve and the binary public key format is [uncompressed][] with the first identifier byte (0x04) truncated, resulting in 40 bytes (X and Y of the curve).  In this document this is referred to as the hashname-key.

The fingerprint is generated by using SHA1 on the binary public key, resulting in a 40 character lower case hex string.

## Open

In order to create a line, a switch must generate a new temporary ECC key, caled the line-key. The line-key is used along with ECDH and AES-128-CTR to encrypt the open and line packets.

The BODY of any open packet is binary and defined with the following byte sections in sequential order:

* `HMAC` - 20 bytes, the calculated HMAC
* `LINE KEY` - 40 bytes, the sender's temporary line public key (X+Y)
* `INNER CIPHERTEXT` - the AES-128-CTR encrypted inner packet

By performing ECDH with the sender's given line-key and the recipient's hashname-key, the resulting 20 byte secret is used to create the AES cipher and decode the inner packet. The first 16 bytes of the secret are the AES key, and the remaining 4 bytes are used as the IV (left-zero-padded).

The inner packet then contains the sender's hashname-key and must be verified.  Using the hashname-key attached to the inner packet and ECDH with the recipients hashname-key, the shared secret is used as the input to the HMAC and verified against the original BODY after the HMAC (bytes 20+).

## Line

Line secrets are generated by using ECDH with both line-keys, and performing a SHA1 with the secret and line ids from the inner packet:

* line encryption key: SHA1(secret, my-line-id, their-line-id)
* line decryption key: SHA1(secret, their-line-id, my-line-id)

Line packets are designed to be very lightweight with minimum overhead for use on networks such as 802.15.4 where there is a very low MTU. The JSON only contains a `"line":"line-id"`, the BODY is binary and defined as:

* `HMAC` - 4 bytes, the first part of the HMAC
* `IV` - 4 bytes
* `CHANNEL CIPHERTEXT` - the AES-128-CTR encrypted channel packet

Using the correct line key the HMAC can be verified/created, and then using that key with the IV the channel packet can be encrypted/decrypted.


[aes]:     https://en.wikipedia.org/wiki/Advanced_Encryption_Standard
[uncompressed]: https://www.secg.org/collateral/sec1_final.pdf

