(function($){var isWebkit=!!~navigator.userAgent.indexOf(' AppleWebKit/');$.fn.console=function(config){var keyCodes={37:moveBackward,39:moveForward,38:previousHistory,40:nextHistory,8:backDelete,46:forwardDelete,35:moveToEnd,36:moveToStart,13:commandTrigger,18:doNothing,9:doComplete};var ctrlCodes={65:moveToStart,69:moveToEnd,68:forwardDelete,78:nextHistory,80:previousHistory,66:moveBackward,70:moveForward,75:deleteUntilEnd};if(config.ctrlCodes){$.extend(ctrlCodes,config.ctrlCodes);}
var altCodes={70:moveToNextWord,66:moveToPreviousWord,68:deleteNextWord};var cursor='<span class="jquery-console-cursor">&nbsp;</span>';var container=$(this);var inner=$('<div class="jquery-console-inner"></div>');var typer=$('<textarea autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="jquery-console-typer"></textarea>');var promptBox;var prompt;var promptLabel=config&&config.promptLabel?config.promptLabel:"> ";var continuedPromptLabel=config&&config.continuedPromptLabel?config.continuedPromptLabel:"> ";var column=0;var promptText='';var restoreText='';var continuedText='';var fadeOnReset=config.fadeOnReset!==undefined?config.fadeOnReset:true;var history=[];if(typeof(Storage)!=="undefined")
{if(localStorage.history)
history=JSON.parse(localStorage.history);}
var ringn=0;var cancelKeyPress=0;var acceptInput=true;var cancelCommand=false;var extern={};(function(){container.append(inner);inner.append(typer);typer.css({position:'absolute',top:0,left:'-9999px'});if(config.welcomeMessage)
message(config.welcomeMessage,'jquery-console-welcome');newPromptBox();if(config.autofocus){inner.addClass('jquery-console-focus');typer.focus();setTimeout(function(){inner.addClass('jquery-console-focus');typer.focus();},100);}
extern.inner=inner;extern.typer=typer;extern.scrollToBottom=scrollToBottom;})();extern.reset=function(){var welcome=(typeof config.welcomeMessage!='undefined');var removeElements=function(){inner.find('div').each(function(){if(!welcome){$(this).remove();}else{welcome=false;}});};var focusConsole=function(){inner.addClass('jquery-console-focus');typer.focus();};if(fadeOnReset){inner.parent().fadeOut(function(){removeElements();newPromptBox();inner.parent().fadeIn(focusConsole);});}
else{removeElements();newPromptBox();focusConsole();}};extern.notice=function(msg,style){var n=$('<div class="notice"></div>').append($('<div></div>').text(msg)).css({visibility:'hidden'});container.append(n);var focused=true;if(style=='fadeout')
setTimeout(function(){n.fadeOut(function(){n.remove();});},4000);else if(style=='prompt'){var a=$('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');n.append(a);focused=false;a.click(function(){n.fadeOut(function(){n.remove();inner.css({opacity:1})});});}
var h=n.height();n.css({height:'0px',visibility:'visible'}).animate({height:h+'px'},function(){if(!focused)inner.css({opacity:0.5});});n.css('cursor','default');return n;};function newPromptBox(){column=0;promptText='';ringn=0;enableInput();promptBox=$('<div class="jquery-console-prompt-box"></div>');var label=$('<span class="jquery-console-prompt-label"></span>');var labelText=extern.continuedPrompt?continuedPromptLabel:promptLabel;promptBox.append(label.text(labelText).show());label.html(label.html().replace(' ','&nbsp;'));prompt=$('<span class="jquery-console-prompt"></span>');promptBox.append(prompt);inner.append(promptBox);updatePromptDisplay();};container.click(function(){if(window.getSelection().toString()){return false;}
inner.addClass('jquery-console-focus');inner.removeClass('jquery-console-nofocus');if(isWebkit){typer.focusWithoutScrolling();}else{typer.css('position','fixed').focus();}
scrollToBottom();return false;});typer.blur(function(){inner.removeClass('jquery-console-focus');inner.addClass('jquery-console-nofocus');});typer.bind('paste',function(e){typer.val("");setTimeout(function(){typer.consoleInsert(typer.val());typer.val("");},0);});typer.keydown(function(e){cancelKeyPress=0;var keyCode=e.keyCode;if(e.ctrlKey&&keyCode==67){cancelKeyPress=keyCode;cancelExecution();return false;}
if(acceptInput){if(keyCode in keyCodes){cancelKeyPress=keyCode;(keyCodes[keyCode])();return false;}else if(e.ctrlKey&&keyCode in ctrlCodes){cancelKeyPress=keyCode;(ctrlCodes[keyCode])();return false;}else if(e.altKey&&keyCode in altCodes){cancelKeyPress=keyCode;(altCodes[keyCode])();return false;}}});typer.keypress(function(e){var keyCode=e.keyCode||e.which;if(isIgnorableKey(e)){return false;}
if((e.ctrlKey||e.metaKey)&&String.fromCharCode(keyCode).toLowerCase()=='v'){return true;}
if(acceptInput&&cancelKeyPress!=keyCode&&keyCode>=32){if(cancelKeyPress)return false;if(typeof config.charInsertTrigger=='undefined'||(typeof config.charInsertTrigger=='function'&&config.charInsertTrigger(keyCode,promptText))){typer.consoleInsert(keyCode);}}
if(isWebkit)return false;});function isIgnorableKey(e){return((e.keyCode==keyCodes.tab||e.keyCode==192)&&e.altKey);};function rotateHistory(n){if(history.length==0)return;ringn+=n;if(ringn<0)ringn=history.length;else if(ringn>history.length)ringn=0;var prevText=promptText;if(ringn==0){promptText=restoreText;}else{promptText=history[ringn- 1];}
if(config.historyPreserveColumn){if(promptText.length<column+ 1){column=promptText.length;}else if(column==0){column=promptText.length;}}else{column=promptText.length;}
updatePromptDisplay();};function previousHistory(){rotateHistory(-1);};function nextHistory(){rotateHistory(1);};function addToHistory(line){history.push(line);if(typeof(Storage)!=="undefined")
{localStorage.history=JSON.stringify(history);}
restoreText='';};function deleteCharAtPos(){if(column<promptText.length){promptText=promptText.substring(0,column)+
promptText.substring(column+1);restoreText=promptText;return true;}else return false;};function backDelete(){if(moveColumn(-1)){deleteCharAtPos();updatePromptDisplay();}};function forwardDelete(){if(deleteCharAtPos()){updatePromptDisplay();}};function deleteUntilEnd(){while(deleteCharAtPos()){updatePromptDisplay();}};function deleteNextWord(){while(column<promptText.length&&!isCharAlphanumeric(promptText[column])){deleteCharAtPos();updatePromptDisplay();}
while(column<promptText.length&&isCharAlphanumeric(promptText[column])){deleteCharAtPos();updatePromptDisplay();}};function commandTrigger(){var line=promptText;if(typeof config.commandValidate=='function'){var ret=config.commandValidate(line);if(ret==true||ret==false){if(ret){handleCommand();}}else{commandResult(ret,"jquery-console-message-error");}}else{handleCommand();}};function scrollToBottom(){var version=jQuery.fn.jquery.split('.');var major=parseInt(version[0]);var minor=parseInt(version[1]);if((major==1&&minor>6)||major>1){inner.prop({scrollTop:inner.prop("scrollHeight")});}
else{inner.attr({scrollTop:inner.attr("scrollHeight")});}};function cancelExecution(){if(typeof config.cancelHandle=='function'){config.cancelHandle();}}
function handleCommand(){if(typeof config.commandHandle=='function'){disableInput();addToHistory(promptText);var text=promptText;if(extern.continuedPrompt){if(continuedText)
continuedText+='\n'+ promptText;else continuedText=promptText;}else continuedText=undefined;if(continuedText)text=continuedText;var ret=config.commandHandle(text,function(msgs){commandResult(msgs);});if(extern.continuedPrompt&&!continuedText)
continuedText=promptText;if(typeof ret=='boolean'){if(ret){commandResult();}else{commandResult('Command failed.',"jquery-console-message-error");}}else if(typeof ret=="string"){commandResult(ret,"jquery-console-message-success");}else if(typeof ret=='object'&&ret.length){commandResult(ret);}else if(extern.continuedPrompt){commandResult();}}};function disableInput(){acceptInput=false;};function enableInput(){acceptInput=true;}
function commandResult(msg,className){column=-1;updatePromptDisplay();if(typeof msg=='string'){message(msg,className);}else if($.isArray(msg)){for(var x in msg){var ret=msg[x];message(ret.msg,ret.className);}}else{inner.append(msg);}
newPromptBox();};function message(msg,className){var mesg=$('<div class="jquery-console-message"></div>');if(className)mesg.addClass(className);mesg.filledText(msg).hide();inner.append(mesg);mesg.show();};typer.consoleInsert=function(data){var text=isNaN(data)?data:String.fromCharCode(data);var before=promptText.substring(0,column);var after=promptText.substring(column);promptText=before+ text+ after;moveColumn(text.length);restoreText=promptText;updatePromptDisplay();};function moveColumn(n){if(column+ n>=0&&column+ n<=promptText.length){column+=n;return true;}else return false;};function moveForward(){if(moveColumn(1)){updatePromptDisplay();return true;}
return false;};function moveBackward(){if(moveColumn(-1)){updatePromptDisplay();return true;}
return false;};function moveToStart(){if(moveColumn(-column))
updatePromptDisplay();};function moveToEnd(){if(moveColumn(promptText.length-column))
updatePromptDisplay();};function moveToNextWord(){while(column<promptText.length&&!isCharAlphanumeric(promptText[column])&&moveForward()){}
while(column<promptText.length&&isCharAlphanumeric(promptText[column])&&moveForward()){}};function moveToPreviousWord(){while(column-1>=0&&!isCharAlphanumeric(promptText[column-1])&&moveBackward()){}
while(column-1>=0&&isCharAlphanumeric(promptText[column-1])&&moveBackward()){}};function isCharAlphanumeric(charToTest){if(typeof charToTest=='string'){var code=charToTest.charCodeAt();return(code>='A'.charCodeAt()&&code<='Z'.charCodeAt())||(code>='a'.charCodeAt()&&code<='z'.charCodeAt())||(code>='0'.charCodeAt()&&code<='9'.charCodeAt());}
return false;};function doComplete(){if(typeof config.completeHandle=='function'){var completions=config.completeHandle(promptText);var len=completions.length;if(len===1){extern.promptText(promptText+ completions[0]);}else if(len>1&&config.cols){var prompt=promptText;var max=0;for(var i=0;i<len;i++){max=Math.max(max,completions[i].length);}
max+=2;var n=Math.floor(config.cols/max);var buffer="";var col=0;for(i=0;i<len;i++){var completion=completions[i];buffer+=completions[i];for(var j=completion.length;j<max;j++){buffer+=" ";}
if(++col>=n){buffer+="\n";col=0;}}
commandResult(buffer,"jquery-console-message-value");extern.promptText(prompt);}}};function doNothing(){};extern.promptText=function(text){if(typeof text==='string'){promptText=text;column=promptText.length;updatePromptDisplay();}
return promptText;};function updatePromptDisplay(){var line=promptText;var html='';if(column>0&&line==''){html=cursor;}else if(column==promptText.length){html=htmlEncode(line)+ cursor;}else{var before=line.substring(0,column);var current=line.substring(column,column+1);if(current){current='<span class="jquery-console-cursor">'+
htmlEncode(current)+'</span>';}
var after=line.substring(column+1);html=htmlEncode(before)+ current+ htmlEncode(after);}
prompt.html(html);scrollToBottom();};function htmlEncode(text){return(text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/</g,'&lt;').replace(/ /g,'&nbsp;').replace(/\n/g,'<br />'));};return extern;};$.fn.filledText=function(txt){$(this).text(txt);$(this).html($(this).html().replace(/\n/g,'<br/>'));return this;};$.fn.focusWithoutScrolling=function(){var x=window.scrollX,y=window.scrollY;$(this).focus();window.scrollTo(x,y);};})(jQuery);